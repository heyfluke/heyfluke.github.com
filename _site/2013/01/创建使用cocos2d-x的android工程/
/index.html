
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>创建使用cocos2d-x的Android工程</title>
    
    <meta name="author" content="Yongchao Lao">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Luke同学的牢骚</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>创建使用cocos2d-x的Android工程 <small>Supporting tagline</small></h1>
</div>

<div class="row">
  <div class="span8">
    <p>#</p>

<p>本文基于cocos2d-x 2.0稳定版，主机操作系统为Mac OSX。对于linux和windows应该是类似的（win下的脚本为bat）。</p>

<p> </p>

<p>cocos2d是一个为ios编写的游戏开发库，流行起来以后创建了跨平台的cocos2d-x库，也可以支持android(主要基于c 开发)。</p>

<p> </p>

<p>创建Android工程的方式为通过cocos2d-x目录下面的create-android-project.sh来创建。因为依赖Android的NDK以及SDK，所以需要先把它们都安装好，并且设置好NDK_ROOT以及ANDROID_SDK_ROOT这两个环境变量指向它们所在目录。如果不想添加这两个变量，也可以在脚本里面修改以下两行：</p>

<p> </p>

<blockquote>
<h1 id='set_environment_paramters'>set environment paramters</h1>

<p>NDK_ROOT_LOCAL=&#8221;/home/laschweinski/android/android-ndk-r5&#8221;</p>

<p>ANDROID_SDK_ROOT_LOCAL=&#8221;/home/laschweinski/android/android-sdk-linux_86&#8221;</p>
</blockquote>

<p> </p>

<p>我把环境变量添加到~/.bash_profile里面。然后运行./create-android-project.sh。整个交互过程需要输入包名、API id、项目名等，参考：</p>

<p> </p>

<blockquote>
<p>agspc98:cocos2d-2.0-x-2.0.4 laoyongchao$ ./create-android-project.sh </p>

<p>use global definition of NDK_ROOT: /Users/laoyongchao/Applications/android-ndk-r6-crystax-2</p>

<p>use global definition of ANDROID_SDK_ROOT: /Users/laoyongchao/Applications/adt-bundle-mac/sdk</p>

<p>Input package path. For example: org.cocos2dx.example</p>

<p>fluke.play.testcocos2dx</p>

<p>Now cocos2d-x supports Android 2.2 or upper version</p>

<p>Available Android targets:</p>

<p>———-</p>

<p>id: 1 or &#8220;android-8&#8221;</p>

<p>     Name: Android 2.2</p>

<p>     Type: Platform</p>

<p>     API level: 8</p>

<p>     Revision: 3</p>

<p>     Skins: HVGA, QVGA, WQVGA400, WQVGA432, WVGA800 (default), WVGA854</p>

<p>     ABIs : armeabi</p>

<p>———-</p>

<p>id: 2 or &#8220;android-17&#8221;</p>

<p>     Name: Android 4.2</p>

<p>     Type: Platform</p>

<p>     API level: 17</p>

<p>     Revision: 1</p>

<p>     Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in</p>

<p>     ABIs : armeabi-v7a</p>

<p>input target id:</p>

<p>1</p>

<p>input your project name:</p>

<p>TestCocos2dx</p>

<p>Created project directory: /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android</p>

<p>Created directory /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/src/fluke/play/testcocos2dx</p>

<p>Added file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/src/fluke/play/testcocos2dx/TestCocos2dx.java</p>

<p>Created directory /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/res</p>

<p>Created directory /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/bin</p>

<p>Created directory /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/libs</p>

<p>Created directory /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/res/values</p>

<p>Added file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/res/values/strings.xml</p>

<p>Created directory /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/res/layout</p>

<p>Added file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/res/layout/main.xml</p>

<p>Added file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/AndroidManifest.xml</p>

<p>Added file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/build.xml</p>

<p>Added file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/proguard-project.txt</p>

<p>Resolved location of library project to: /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/cocos2dx/platform/android/java</p>

<p>Updated project.properties</p>

<p>Updated local.properties</p>

<p>Updated file /Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android/proguard-project.txt</p>

<p>agspc98:cocos2d-2.0-x-2.0.4 laoyongchao$ </p>
</blockquote>

<p> </p>

<p>然后是编译的过程，到TestCocos2dx目录去，发现工程文件都被整理在proj.android目录里面了（每个平台都统一这样的目录结构，比如ios的在proj.ios），到proj.android目录下运行./build_native.sh，结果发现很多错误，怀疑是对ndk的版本有要求，就换成ndk-r8c，结果成功：</p>

<p> </p>

<blockquote>
<p>….</p>

<p>Prebuilt       : curl.a<br />StaticLibrary  : libextension.a</p>

<p>SharedLibrary  : libgame.so</p>

<p>Install        : libgame.so =&gt; libs/armeabi/libgame.so</p>

<p>make: Leaving directory <code>/Users/laoyongchao/Documents/projects/os/cocos2d-2.0-x-2.0.4/TestCocos2dx/proj.android&#39;</code></p>

<p>agspc98:proj.android laoyongchao$ </p>
</blockquote>

<p> </p>

<p>然后编译apk，如果是第一次运行，还需要更新以下环境：</p>

<p> </p>

<blockquote>
<p>agspc98:proj.android laoyongchao$ android update project –path .</p>

<p>Updated local.properties</p>

<p>Updated file ./proguard-project.txt</p>
</blockquote>

<p> </p>

<p>另外也可以通过ANDROID_HOME变量指向sdk路径的方式来使得编译时候能找到SDK。</p>

<p> </p>

<p>我很悲催，上面两种方式都不可行，暂时不想花时间去检查ant的问题，就用第三种方式，直接在ant命令行用-D来插入定义：</p>

<p> </p>

<blockquote>
<p>ant debug -Dsdk.dir=/Users/laoyongchao/Applications/adt-bundle-mac/sdk</p>
</blockquote>

<p> </p>

<p>然后安装：</p>

<p> </p>

<blockquote>
<p>agspc98:proj.android laoyongchao$ adb install bin/TestCocos2dx-debug.apk </p>

<ul>
<li>
<p>daemon not running. starting it now on port 5037 *</p>
</li>

<li>
<p>daemon started successfully *</p>
</li>
</ul>

<p>3458 KB/s (1624090 bytes in 0.458s)</p>

<p>pkg: /data/local/tmp/TestCocos2dx-debug.apk</p>

<p>Success</p>
</blockquote>

<p> </p>

<p> </p>

<p> </p>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2013/01/%e9%81%87%e5%88%b0mountain-lion%e7%9a%84%e4%b8%a4%e4%b8%aabug/" title="遇到Mountain Lion的两个bug">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2013/01/%e5%9c%a8%e8%b6%8a%e7%8b%b1%e5%90%8e%e7%9a%84ipad%e4%b8%ad%e6%89%be%e5%88%ab%e7%9a%84%e7%a8%8b%e5%ba%8f%e7%9b%ae%e5%bd%95/
/" title="在越狱后的iPad中找别的程序目录">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>25 January 2013</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#android-ref">android <span>2</span></a></li>
     
    	<li><a href="/tags.html#cocos2d-x-ref">cocos2d-x <span>1</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Yongchao Lao 2013
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

